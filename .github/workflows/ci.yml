name: CI

on:
  pull_request:
    branches: [main]
  push:
    branches: [main]

jobs:
  build-and-lint:
    name: Build and Lint
    runs-on: ubuntu-latest

    steps:
    - name: ðŸ“¥ Checkout code
      uses: actions/checkout@v4

    - name: ðŸ”§ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'

    - name: ðŸ“¦ Install dependencies
      run: npm ci --prefer-offline --no-audit

    - name: ðŸ”§ Create mock Amplify outputs for CI
      run: |
        cat > amplify_outputs.json << 'EOF'
        {
          "version": "1.4",
          "auth": {
            "aws_region": "us-east-2",
            "user_pool_id": "mock-pool-id",
            "user_pool_client_id": "mock-client-id",
            "identity_pool_id": "us-east-2:mock-identity-pool",
            "password_policy": {
              "min_length": 8,
              "require_lowercase": false,
              "require_uppercase": false,
              "require_numbers": false,
              "require_symbols": false
            },
            "standard_required_attributes": ["email"],
            "username_attributes": ["email"],
            "user_verification_types": ["email"],
            "mfa_configuration": "NONE",
            "mfa_methods": []
          }
        }
        EOF

    - name: ðŸ” Run ESLint
      run: npm run lint

    - name: ðŸ—ï¸ Build application
      run: npm run build
